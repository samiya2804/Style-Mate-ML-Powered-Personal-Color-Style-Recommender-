{% extends 'base.html' %}

{% block title %}Recommendation History{% endblock %}

{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/recommendations.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">


<div class="back-frame animate__animated animate__fadeInLeft">
    <a href="/dashboard" class="back-btn " title="Back to Dashboard">
        <i class="fa-solid fa-circle-arrow-left back"></i> Back to Dashboard
    </a>
    
</div>

   <div class="text-center mb-5 mt-4 section-header">
      <h1 class="heading3 animate__animated animate__fadeInDown">âœ¨ Your Style Analysis History</h1>

    </div>

<div class="container uploads-grid animate__animated animate__fadeInUp">
    {% for upload in uploads %}
    <div class="card upload-card" id="card-{{ loop.index }}">
        
        <div class="image-container">
            <img src="{{ url_for('uploaded_file', filename=upload.image_url) }}" alt="Uploaded Image Preview">
        </div>

        <div class="upload-card-content">
            
            <div class="short-detail">
                <div class="short-row">
                    <strong>Date:</strong> <span>{{ upload.date }}</span>
                </div>
                <div class="short-row">
                    <strong>Time:</strong> <span>{{ upload.time }}</span>
                </div>
                <div class="short-row">
                    <strong>Tone:</strong> <span class="tone-tag">{{ upload.skin_tone or "Unknown" }}</span>
                </div>


                
                <form 
    action="{{ url_for('delete_upload', upload_id=upload.id) }}" 
    method="POST"
    onsubmit="return confirm('Are you sure you want to delete this analysis?');"
    class="delete-form"
>
    <button type="submit" class="delete-btn">
        ðŸ—‘ Delete Analysis
    </button>
</form>
                
                <button class="show-more-btn" onclick="toggleDetail('card-{{ loop.index }}')">
                    <span class="btn-label">Show More</span>
                    <i class="fa-solid fa-chevron-down toggle-icon"></i>
                </button>
            </div>

            <div class="full-detail">
                <div class="detail-section">
                    <strong class="section-title">ðŸŽ¨ Recommended Colors:</strong>
                    {% if upload.season_colors %}
                    <div class="color-swatches">
                        {% for color in upload.season_colors[:9] %}
                            <div class="swatch hover-scale" style="background-color: {{ color }};" title="{{ color }}"></div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="no-data">No data found.</p>
                    {% endif %}
                </div>

                <div class="detail-section">
                    <strong class="section-title text-danger">ðŸš« Avoid Colors:</strong>
                    {% if upload.avoid_colors %}
                    <div class="color-swatches">
                        {% for color in upload.avoid_colors[:5] %}
                            <div class="swatch swatch-avoid hover-scale" style="background-color: {{ color }};" title="{{ color }}"></div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="no-data">No data found.</p>
                    {% endif %}
                </div>

                <button class="show-less-btn" onclick="toggleDetail('card-{{ loop.index }}')">
                    <span class="btn-label">Show Less</span>
                    <i class="fa-solid fa-chevron-up toggle-icon"></i>
                </button>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<style>
  .back{
  color: rgb(204, 118, 132);
  text-decoration: none;
}

.back-btn{
  color: rgb(204, 118, 132);
  text-decoration: none;
  margin-left: 2px;
}

    
.delete-form {
    margin-top: 12px;
    text-align: center;
}

.delete-btn {
    background: #ff4d4f;
    color: white;
    border: none;
    padding: 6px 14px;
    border-radius: 8px;
    font-size: 14px;
    cursor: pointer;
}

.delete-btn:hover {
    background: #d9363e;
}

:hover .back-frame{
  border: 1px solid rgb(234, 101, 123);
}
/* Back Button */
.back-frame { position: absolute; top: 1.5rem; left: 20px; z-index: 1000; padding: 10px 15px; background: white; border-radius: 15px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); }
@media (max-width: 768px) {
    .back-frame { position: static; margin: 15px; box-shadow: none; }
}
</style>
<script>
function toggleDetail(id) {
    let card = document.getElementById(id);
    card.classList.toggle("show");
}
</script>

{% endblock %}
